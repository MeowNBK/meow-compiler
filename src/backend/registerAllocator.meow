export class RegisterAllocator {
    fn init(numRegisters) {
        // Máº·c dÃ¹ khÃ´ng dÃ¹ng numRegisters, cá»© Ä‘á»ƒ Ä‘Ã¢y cho vui, 
        // biáº¿t Ä‘Ã¢u sau nÃ y láº¡i cáº§n ğŸ¤£
        this._numRegisters = (numRegisters > 0) ? numRegisters : 256;
        this.reset();
    }

    fn reset() {
        this._nextRegister = 0; // Báº¯t Ä‘áº§u tá»« thanh ghi 0
    }

    // KhÃ´ng cáº§n hÃ m _grow ná»¯a, vÃ¬ ta cáº¥p phÃ¡t vÃ´ háº¡n ğŸš€

    fn ralloc() {
        // Cá»© láº¥y thanh ghi tiáº¿p theo vÃ  tÄƒng biáº¿n Ä‘áº¿m. Ez game!
        let r = this._nextRegister;
        this._nextRegister++;
        return r;
    }

    fn rallocBlock(n) {
        assert(n > 0, "RegisterAllocator.rallocBlock: n pháº£i > 0");
        // Láº¥y má»™t khá»‘i vÃ  tÄƒng biáº¿n Ä‘áº¿m lÃªn n. QuÃ¡ Ä‘Æ¡n giáº£n!
        let startReg = this._nextRegister;
        this._nextRegister += n;
        return startReg;
    }

    fn free(reg) {
        // "TÃ´i khÃ´ng quan tÃ¢m." - RegisterAllocator said. ğŸ˜¼
        // HÃ m nÃ y giá» khÃ´ng lÃ m gÃ¬ cáº£.
    }

    fn beginScope() { 
        // Scope lÃ  gÃ¬? CÃ³ Äƒn Ä‘Æ°á»£c khÃ´ng? ğŸ¤”
    }

    fn endScope() {
        // Káº¿t thÃºc scope? Ká»‡ nÃ³ Ä‘i. ğŸ¤£
    }

    fn take() {
        // take() giá» cÅ©ng nhÆ° ralloc() thÃ´i
        return this.ralloc();
    }

    fn withTemp(fnUse) {
        let r = this.ralloc();
        let out = fnUse(r);
        // KhÃ´ng free ná»¯a nhÃ©. Cá»© Ä‘á»ƒ Ä‘Ã³.
        return out;
    }

    fn usedRegisters() { 
        // Sá»‘ thanh ghi Ä‘Ã£ dÃ¹ng chÃ­nh lÃ  giÃ¡ trá»‹ cá»§a biáº¿n Ä‘áº¿m
        return this._nextRegister;
    }

    fn numRegisters() { 
        // Vá» máº·t lÃ½ thuyáº¿t lÃ  "vÃ´ háº¡n", nhÆ°ng ta cá»© tráº£ vá» cÃ¡i nÃ y cho nÃ³ cÃ³ ğŸ¤“
        return this._nextRegister; 
    }
}